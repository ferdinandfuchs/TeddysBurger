---
interface Props {
  title?: string;
  subtitle?: string;
  backgroundImage?: string;
  backgroundVideo?: string;
  buttonText?: string;
}

const {
  title = "Teddy's Burger",
  subtitle = "Die besten Burger der Stadt",
  backgroundImage,
  backgroundVideo,
  buttonText = "Zur Speisekarte",
} = Astro.props;

// Generate mobile video path from desktop video
const mobileVideo = backgroundVideo?.replace('.mp4', '-mobile.mp4');
---

<section
  id="hero"
  class="relative min-h-[70vh] md:min-h-[80vh] flex items-center justify-center"
>
  <!-- Background Video or Image -->
  {backgroundVideo ? (
    <div class="absolute inset-0 overflow-hidden">
      <video
        id="hero-video"
        autoplay
        muted
        loop
        playsinline
        webkit-playsinline
        disablepictureinpicture
        class="absolute inset-0 w-full h-full object-cover"
        data-src-desktop={backgroundVideo}
        data-src-mobile={mobileVideo}
      >
        <source src={backgroundVideo} type="video/mp4" />
      </video>
      <div class="absolute inset-0 bg-black/50"></div>
    </div>
  ) : backgroundImage ? (
    <div
      class="absolute inset-0 bg-cover bg-center bg-no-repeat"
      style={`background-image: url('${backgroundImage}')`}
    >
      <div class="absolute inset-0 bg-black/60"></div>
    </div>
  ) : (
    <div class="absolute inset-0 bg-background-alt">
      <div class="absolute inset-0 bg-gradient-to-b from-background/50 to-background"></div>
    </div>
  )}

  <!-- Content -->
  <div class="relative z-10 container mx-auto px-4 text-center">
    <h1 class="font-heading text-5xl md:text-7xl lg:text-8xl font-bold mb-4 md:mb-6">
      {title}
    </h1>

    {subtitle && (
      <p class="text-xl md:text-2xl lg:text-3xl mb-8 md:mb-10 text-foreground/90 max-w-2xl mx-auto">
        {subtitle}
      </p>
    )}

    {buttonText && (
      <a
        href="#menu"
        class="inline-block bg-accent hover:bg-accent-hover text-foreground px-8 py-4 rounded-lg font-semibold text-lg transition-colors"
      >
        {buttonText}
      </a>
    )}
  </div>
</section>

{backgroundVideo && (
  <script>
    // Responsive video loading and autoplay
    document.addEventListener('DOMContentLoaded', () => {
      const video = document.getElementById('hero-video') as HTMLVideoElement;
      if (video) {
        // Select appropriate video source based on screen width
        const isMobile = window.innerWidth < 768;
        const desktopSrc = video.dataset.srcDesktop;
        const mobileSrc = video.dataset.srcMobile;
        const selectedSrc = isMobile && mobileSrc ? mobileSrc : desktopSrc;

        if (selectedSrc) {
          const source = video.querySelector('source');
          if (source && source.src !== selectedSrc) {
            source.src = selectedSrc;
            video.load();
          }
        }

        // Force autoplay
        video.muted = true;
        video.play().catch(() => {
          // If autoplay fails, try playing on first user interaction
          const playOnInteraction = () => {
            video.play();
            document.removeEventListener('touchstart', playOnInteraction);
            document.removeEventListener('click', playOnInteraction);
          };
          document.addEventListener('touchstart', playOnInteraction, { once: true });
          document.addEventListener('click', playOnInteraction, { once: true });
        });
      }
    });
  </script>
)}
